<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gi·ªè H√†ng - Sport Shop</title>
  <link
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          rel="stylesheet"
  />
  <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  />
  <style>
    body {
      background-color: #f8f9fa;
    }

    .header {
      background: linear-gradient(135deg, #2c3e50, #3498db);
      padding: 15px 0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .header .logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .header .header-title {
      font-size: 32px;
      font-weight: 700;
      color: #fff;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      margin-left: 15px;
    }

    .cart-container {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin: 30px auto;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .cart-title {
      color: #2c3e50;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f1f1f1;
    }

    .cart-item {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .cart-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .product-image {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .product-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .product-brand,
    .product-category {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 3px;
    }

    .product-price {
      color: #e74c3c;
      font-weight: 600;
      font-size: 1.1rem;
      margin: 0;
    }

    .badge-danger {
      background: #e74c3c;
      padding: 5px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .quantity-control {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #f8f9fa;
      padding: 8px;
      border-radius: 8px;
      width: fit-content;
    }

    .quantity-btn {
      background: #3498db;
      color: white;
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .quantity-btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
      color: white;
      text-decoration: none;
    }

    .quantity-value {
      font-weight: 600;
      color: #2c3e50;
      min-width: 20px;
      text-align: center;
    }

    .view-btn,
    .remove-btn {
      width: 35px;
      height: 35px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .view-btn {
      background: #3498db;
      color: white;
    }

    .view-btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
      color: white;
    }

    .remove-btn {
      background: #f8f9fa;
      color: #e74c3c;
    }

    .remove-btn:hover {
      background: #fee2e2;
      transform: translateY(-2px);
      color: #c0392b;
    }

    .cart-summary {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .total-price {
      font-size: 1.5rem;
      font-weight: 600;
      color: #e74c3c;
      margin: 0;
    }

    .checkout-btn {
      background: linear-gradient(45deg, #4b6cb7, #182848);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .checkout-btn:hover {
      background: linear-gradient(45deg, #182848, #4b6cb7);
      transform: translateY(-2px);
      color: white;
      text-decoration: none;
    }

    .empty-cart {
      text-align: center;
      padding: 50px 0;
      animation: fadeIn 0.5s ease-out;
    }

    .empty-cart i {
      font-size: 4rem;
      color: #bdc3c7;
      margin-bottom: 20px;
    }

    .div-continue-shopping{
        display: inline-block;
        height: fit-content;
        width: fit-content;
    }

    .continue-shopping {
      color: #3498db;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      display: grid;
      grid-template-columns: auto auto;
    }
    .continue{
        height: fit-content;
        padding-top: 20px;
        padding-left: 10px;
        display: flex;
        justify-items: center;
    }


    .continue-shopping:hover {
      color: #2980b9;
      transform: translateX(-5px);
      text-decoration: none;
    }

    .notification {
      margin-bottom: 30px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Feature badges */
    .feature-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 5px 0;
    }

    .feature-badge {
      font-size: 0.8rem;
      padding: 3px 8px;
      background-color: #f1f1f1;
      border-radius: 12px;
      color: #333;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .cart-item {
        padding: 15px;
      }

      .product-image {
        width: 80px;
        height: 80px;
        margin: 0 auto 10px;
      }

      .quantity-control {
        margin: 10px auto;
      }

      .view-btn,
      .remove-btn {
        width: 30px;
        height: 30px;
      }

      .col-md-1,
      .col-md-2,
      .col-md-4 {
        text-align: center;
        margin: 5px 0;
      }

      .d-flex.justify-content-end {
        justify-content: center !important;
        margin-top: 10px;
      }
    }

    .modal-content {
      border: none;
      border-radius: 15px;
    }

    .modal-header {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      border-radius: 15px 15px 0 0;
      padding: 15px 20px;
    }

    .modal-title i {
      margin-right: 10px;
    }

    .modal-body {
      padding: 20px;
    }

    .address-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .address-item {
      margin-bottom: 15px;
      position: relative;
    }

    .address-radio {
      display: none;
    }

    .address-label {
      display: block;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .address-radio:checked + .address-label {
      border-color: #3498db;
      background-color: #f8f9fa;
    }

    .address-info {
      margin-left: 25px;
    }

    .address-text,
    .phone-text {
      margin: 0;
      line-height: 1.5;
      color: #333;
    }

    .address-text i,
    .phone-text i {
      width: 20px;
      color: #3498db;
    }

    .no-address {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    .btn-add-address {
      background: #2ecc71;
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      text-decoration: none;
      transition: all 0.3s ease;
      display: inline-block;
      margin-top: 10px;
    }

    .btn-add-address:hover {
      background: #27ae60;
      transform: translateY(-2px);
      color: white;
      text-decoration: none;
    }

    .modal-footer {
      border-top: 1px solid #eee;
      padding: 15px 20px;
    }

    .modal-footer .btn {
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 500;
    }

    .btn-secondary {
      background: #95a5a6;
      border: none;
    }

    .btn-primary {
      background: #3498db;
      border: none;
    }

    .btn-secondary:hover,
    .btn-primary:hover {
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
<!-- Modal -->
<div class="modal fade" id="printCartModal" tabindex="-1" role="dialog" aria-labelledby="printCartModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content shadow-lg rounded">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title font-weight-bold" id="printCartModalLabel">Th√¥ng tin gi·ªè h√†ng</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body px-4">
        <div id="print-cart-items" class="row"></div>
        <hr>

      </div>

      <div class="modal-footer d-flex justify-content-between align-items-center">
        <!-- QR Code b√™n tr√°i -->
        <div class="d-flex align-items-center">
          <div id="qrcode-print" class="mt-2 ml-3"></div>
        </div>

        <!-- C√°c n√∫t b√™n ph·∫£i -->
        <div class="d-flex align-items-center">
          <button class="btn btn-secondary mr-2" data-dismiss="modal">ƒê√≥ng</button>
          <button class="btn btn-primary" onclick="triggerPrint()">In</button>
        </div>
      </div>


    </div>
  </div>
</div>
</div>

<!-- Th√™m modal ch·ªçn ƒë·ªãa ch·ªâ v√†o tr∆∞·ªõc th·∫ª ƒë√≥ng body -->
<div
        class="modal fade"
        id="addressModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="addressModalLabel"
        aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addressModalLabel">
          <i class="fas fa-map-marker-alt"></i> Ch·ªçn ƒë·ªãa ch·ªâ nh·∫≠n h√†ng
        </h5>
        <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="address-list">
          <div class="address-item" th:each="address : ${user.addresses}">
            <input
                    type="radio"
                    name="selectedAddress"
                    th:id="${'address-' + address.id}"
                    th:value="${address.id}"
                    class="address-radio"
            />
            <label
                    th:for="${'address-' + address.id}"
                    class="address-label"
            >
              <div class="address-info">
                <p class="address-text">
                  <i class="fas fa-map-marker-alt"></i>
                  <span th:text="${address.address}"></span>
                </p>
                <p class="phone-text">
                  <i class="fas fa-phone"></i>
                  <span th:text="${address.phone}"></span>
                </p>
              </div>
            </label>
          </div>
        </div>

        <div class="no-address" th:if="${#lists.isEmpty(user.addresses)}">
          <p>B·∫°n ch∆∞a c√≥ ƒë·ªãa ch·ªâ nh·∫≠n h√†ng</p>
          <a th:href="@{/user/info}" class="btn btn-add-address">
            <i class="fas fa-plus"></i> Th√™m ƒë·ªãa ch·ªâ m·ªõi
          </a>
        </div>
      </div>
      <div class="modal-footer">
        <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
        >
          H·ªßy
        </button>
        <button
                type="button"
                class="btn btn-primary"
                onclick="proceedToCheckout()"
        >
          X√°c Nh·∫≠n
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Header -->
<header class="header">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between">
      <a
              href="/home-page"
              class="d-flex align-items-center text-decoration-none"
      >
        <img class="logo" th:src="@{/images/logo.png}" alt="Logo" />
        <h1 class="header-title">FoneHub</h1>
      </a>
    </div>
  </div>
</header>

<!-- Cart Content -->
<div class="container">
  <div class="cart-container">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2 class="cart-title">
        <i class="fas fa-shopping-cart"></i> Gi·ªè H√†ng
      </h2>
      <button class="btn btn-outline-secondary btn-sm" onclick="fetchCartDataForPrint()">
        üñ®Ô∏è In Gi·ªè H√†ng
      </button>
    </div>


    <!-- Notification -->
    <div class="notification" th:if="${notification}">
      <div
              role="alert"
              class="alert"
              th:classappend="${notification.equals('Fail')} ? 'alert-danger' : 'alert-success'"
      >
        <span th:text="${message}"></span>
      </div>
    </div>

    <!-- Empty Cart Message -->
    <div class="empty-cart" th:if="${#lists.isEmpty(carts)}">
      <i class="fas fa-shopping-cart"></i>
      <h3>Gi·ªè h√†ng tr·ªëng</h3>
      <p>H√£y th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng c·ªßa b·∫°n</p>
      <div class="div-continue-shopping">
        <a href="/home-page" class="continue-shopping">
          <i class="fas fa-arrow-left"></i> <div class="continue">Ti·∫øp t·ª•c mua s·∫Øm</div>
        </a>
      </div>
    </div>

    <!-- Cart Items -->
    <div th:unless="${#lists.isEmpty(carts)}">
      <div class="cart-item" th:each="cart : ${carts}">
        <div class="row align-items-center">
          <div class="col-md-2">
            <img
                    th:if="${!cart.product.images.empty}"
                    th:src="${cart.product.images[0].imageLink}"
                    class="product-image"
                    alt="Product"
                    onerror="this.src='https://via.placeholder.com/120x120'"
            />
          </div>
          <div class="col-md-4">
            <h5 class="product-name" th:text="${cart.product.name}">
              Product Name
            </h5>
            <div class="product-brand" th:text="${cart.product.brand.name}">
              Brand Name
            </div>
            <div
                    class="product-category"
                    th:text="${cart.product.category.name}"
            >
              Category Name
            </div>
          </div>
          <div class="col-md-2">
            <p class="product-price" th:text="${#numbers.formatDecimal(cart.product.price, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}">
              Price
            </p>
            <span
                    class="badge badge-danger"
                    th:if="${cart.product.discount > 0}"
                    th:text="'Gi·∫£m ' + ${cart.product.discount} + '%'"
            >
                </span>
          </div>
          <div class="col-md-2">
            <div class="quantity-control">
              <a
                      class="quantity-btn"
                      th:if="${cart.quantity > 1}"
                      th:href="@{/user/cart/{id}/{quantity}(id=${cart.product.id}, quantity=-1)}"
              >
                <i class="fas fa-minus"></i>
              </a>
              <span class="quantity-value" th:text="${cart.quantity}"
              >Quantity</span
              >
              <a
                      class="quantity-btn"
                      th:href="@{/user/cart/{id}/{quantity}(id=${cart.product.id}, quantity=1)}"
              >
                <i class="fas fa-plus"></i>
              </a>
            </div>
          </div>
          <div class="col-md-1">
            <p class="product-price"
               th:text="${#numbers.formatDecimal((cart.product.price * (100 - cart.product.discount) / 100) * cart.quantity, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}">
              Total
            </p>
          </div>
          <div class="col-md-1 d-flex justify-content-end">
            <a
                    th:href="@{'/home/product/' + ${cart.product.id}}"
                    class="view-btn mr-2"
            >
              <i class="fas fa-eye"></i>
            </a>
            <a
                    th:href="@{/user/cart/delete/{id}(id=${cart.product.id})}"
                    class="remove-btn"
            >
              <i class="fas fa-trash"></i>
            </a>
          </div>
        </div>
      </div>

      <!-- Cart Summary -->
      <div class="cart-summary">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h4>T·ªïng Ti·ªÅn:</h4>
            <p class="total-price" th:text="${#numbers.formatDecimal(#aggregates.sum(carts.![product.price * quantity]), 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></p>
          </div>
          <div class="col-md-6 text-end">
            <button onclick="showAddressModal()" class="checkout-btn">
              <i class="fas fa-credit-card me-2"></i>
              Thanh To√°n
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function showAddressModal() {
    $("#addressModal").modal("show");
  }

  function proceedToCheckout() {
    const selectedAddress = document.querySelector(
      'input[name="selectedAddress"]:checked'
    );
    if (!selectedAddress) {
      alert("Vui l√≤ng ch·ªçn ƒë·ªãa ch·ªâ nh·∫≠n h√†ng");
      return;
    }

    // Chuy·ªÉn ƒë·∫øn trang thanh to√°n v·ªõi ƒë·ªãa ch·ªâ ƒë√£ ch·ªçn
    window.location.href = `/user/checkout/${selectedAddress.value}`;
  }
  function fetchCartDataForPrint() {
    fetch('/user/cart/print')
            .then(res => res.json())
            .then(data => {
              const container = document.getElementById("print-cart-items");
              container.innerHTML = "";

              data.forEach(item => {
                const html = `
        <div class="col-md-6 mb-3">
          <div class="border rounded p-3 d-flex align-items-center">
            <img src="${item.image || '/images/default.jpg'}" class="img-thumbnail mr-3" style="width: 80px; height: 80px; object-fit: cover;">
            <div>
              <h6 class="font-weight-bold mb-1">${item.productName}</h6>
              <p class="mb-1">S·ªë l∆∞·ª£ng: <strong>${item.quantity}</strong></p>
              <p class="mb-0 text-danger">ƒê∆°n gi√°: ${item.price.toLocaleString()}‚Ç´</p>
            </div>
          </div>
        </div>
      `;
                container.insertAdjacentHTML('beforeend', html);
              });

              // G·ªçi th√™m QR code t·ª´ backend
              fetch('/user/cart/qr')
                      .then(res => res.json())
                      .then(data => {
                        const qrDiv = document.getElementById('qrcode-print');
                        qrDiv.innerHTML = `
  <img src="data:image/png;base64,${data.qrCode}"
       alt="QR Code"
       style="width: 120px; height: 120px; border: 1px solid #ccc; border-radius: 6px;" />
`;
                      });

              $('#printCartModal').modal('show');
            })
            .catch(err => {
              alert("Kh√¥ng th·ªÉ t·∫£i gi·ªè h√†ng.");
              console.error(err);
            });
  }

  function triggerPrint() {
    const content = document.querySelector('#print-cart-items').innerHTML;
    const win = window.open('', '_blank');
    win.document.write(`
<html>
  <head>
    <title>In Gi·ªè H√†ng</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  </head>
  <body>
    <div class="container mt-4">
      <h4 class="text-center mb-4">TH√îNG TIN GI·ªé H√ÄNG</h4>
      <div class="row">
        ${content}
      </div>
    </div>
  </body>
</html>
`);
    win.document.close();
    win.focus();
    win.print();
  }
</script>
</body>
</html>
